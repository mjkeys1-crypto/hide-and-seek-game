<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Board Preview - Hide & Seek</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #1a1a2e;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #4facfe;
        }
        .back-link {
            text-align: center;
            margin-bottom: 20px;
        }
        .back-link a {
            color: #4facfe;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid #4facfe;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .back-link a:hover {
            background: #4facfe;
            color: #1a1a2e;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .board-card {
            background: #16213e;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .board-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
        }
        .board-card h3 {
            padding: 12px;
            background: #0f3460;
            text-align: center;
            font-size: 16px;
        }
        .board-card canvas {
            display: block;
            width: 100%;
            height: 220px;
        }
        .board-info {
            padding: 8px 12px;
            font-size: 12px;
            color: #aaa;
        }
        .board-info span {
            display: inline-block;
            background: #0f3460;
            padding: 2px 6px;
            border-radius: 4px;
            margin: 2px;
        }
        .click-hint {
            text-align: center;
            font-size: 11px;
            color: #666;
            padding-bottom: 8px;
        }

        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal-content {
            background: #16213e;
            border-radius: 16px;
            max-width: 95vw;
            max-height: 95vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #0f3460;
        }
        .modal-header h2 {
            color: #4facfe;
        }
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0 10px;
        }
        .modal-close:hover {
            color: #ff4444;
        }
        .modal-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        .modal-canvas-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #0a0a15;
            padding: 10px;
        }
        #modal-canvas {
            max-width: 100%;
            max-height: 70vh;
        }
        .modal-sidebar {
            width: 280px;
            padding: 20px;
            background: #1a1a2e;
            overflow-y: auto;
            max-height: 75vh;
        }
        .modal-sidebar h3 {
            color: #4facfe;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #2a2a4a;
        }
        .detail-label {
            color: #888;
        }
        .detail-value {
            color: #fff;
            font-weight: bold;
        }
        .color-swatch {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            vertical-align: middle;
            margin-left: 8px;
            border: 1px solid #444;
        }
        .section-title {
            color: #4facfe;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .legend {
            margin-top: 15px;
            padding: 10px;
            background: #0f3460;
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 13px;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .camera-controls {
            margin-top: 15px;
            padding: 10px;
            background: #0f3460;
            border-radius: 8px;
        }
        .camera-controls label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #888;
        }
        .camera-controls input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
        }
        .view-btn {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            background: #4facfe;
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 13px;
        }
        .view-btn:hover {
            background: #3d8bd4;
        }
        .nav-arrow {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(79, 172, 254, 0.8);
            color: white;
            border: none;
            font-size: 40px;
            padding: 20px 15px;
            cursor: pointer;
            z-index: 1001;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .nav-arrow:hover {
            background: rgba(79, 172, 254, 1);
            transform: translateY(-50%) scale(1.1);
        }
        .nav-prev {
            left: 20px;
        }
        .nav-next {
            right: 20px;
        }
        .board-counter {
            text-align: center;
            color: #888;
            font-size: 14px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Board Preview - All Mazes</h1>
    <div class="back-link">
        <a href="index.html">Back to Game</a>
    </div>
    <div id="grid" class="grid"></div>

    <!-- Modal for detailed view -->
    <div id="modal" class="modal-overlay">
        <button class="nav-arrow nav-prev" onclick="prevBoard()" title="Previous Board">&#10094;</button>
        <button class="nav-arrow nav-next" onclick="nextBoard()" title="Next Board">&#10095;</button>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Board Name</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-canvas-container">
                    <canvas id="modal-canvas" width="800" height="600"></canvas>
                </div>
                <div class="modal-sidebar">
                    <h3>Board Details</h3>
                    <div id="board-details"></div>

                    <div class="section-title">Legend</div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #ff4444;"></div>
                            <span>Seeker Spawn</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #44ff44;"></div>
                            <span>Hider Spawn</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #00ff00;"></div>
                            <span>Left Portal</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #ff0000;"></div>
                            <span>Right Portal</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #ffd700;"></div>
                            <span>Coin Spawn</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot" style="background: #ff00ff;"></div>
                            <span>Powerup Spawn</span>
                        </div>
                    </div>

                    <div class="section-title">Camera Controls</div>
                    <div class="camera-controls">
                        <label>Height: <span id="height-val">70</span></label>
                        <input type="range" id="cam-height" min="30" max="120" value="70" oninput="updateCamera()">
                        <label>Angle: <span id="angle-val">40</span></label>
                        <input type="range" id="cam-angle" min="0" max="80" value="40" oninput="updateCamera()">
                        <label>Rotation: <span id="rotation-val">0</span></label>
                        <input type="range" id="cam-rotation" min="0" max="360" value="0" oninput="updateCamera()">
                        <button class="view-btn" onclick="setTopView()">Top-Down View</button>
                        <button class="view-btn" onclick="setGameView()">Game View</button>
                        <button class="view-btn" onclick="setSeekerView()">Seeker POV</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/three@0.140.0/build/three.min.js"></script>
    <script>
        const CONFIG = {
            ARENA_RADIUS: 40,
            WALL_HEIGHT: 5,
            PLAYER_RADIUS: 1.5
        };

        // BOARDS array - synced from game3d.js
        const BOARDS = [
            {
                name: "The Garden",
                spawns: { seeker: { x: -25, z: -25 }, hider: { x: 25, z: 25 } },
                style: { floor: 0x3d5c3d, wall: 0x8b4513, wallHighlight: 0x228b22, sky: 0x87CEEB },
                theme: 'garden',
                walls: [
                    { x: -32, z: -28, w: 16, d: 2 },
                    { x: 16, z: -28, w: 16, d: 2 },
                    { x: -32, z: 28, w: 16, d: 2 },
                    { x: 16, z: 28, w: 16, d: 2 },
                    { x: -32, z: -26, w: 2, d: 16 },
                    { x: -32, z: 12, w: 2, d: 16 },
                    { x: 30, z: -26, w: 2, d: 16 },
                    { x: 30, z: 12, w: 2, d: 16 },
                    { x: -20, z: -16, w: 12, d: 2 },
                    { x: -20, z: -14, w: 2, d: 8 },
                    { x: 8, z: -16, w: 12, d: 2 },
                    { x: 18, z: -14, w: 2, d: 8 },
                    { x: -15, z: 0, w: 10, d: 2 },
                    { x: 5, z: 0, w: 10, d: 2 },
                    { x: -20, z: 14, w: 12, d: 2 },
                    { x: -20, z: 8, w: 2, d: 8 },
                    { x: 8, z: 14, w: 12, d: 2 },
                    { x: 18, z: 8, w: 2, d: 8 },
                    { x: -8, z: -8, w: 4, d: 4 },
                    { x: 4, z: 6, w: 4, d: 4 }
                ]
            },
            {
                name: "The Haunted Maze",
                spawns: { seeker: { x: -25, z: -25 }, hider: { x: 25, z: 25 } },
                style: { floor: 0x1a1a2e, wall: 0x4a4a6a, sky: 0x0a0a1a },
                theme: 'haunted',
                walls: [
                    { x: -30, z: -30, w: 16, d: 2 },
                    { x: 14, z: -30, w: 16, d: 2 },
                    { x: -30, z: 28, w: 16, d: 2 },
                    { x: 14, z: 28, w: 16, d: 2 },
                    { x: -32, z: -28, w: 2, d: 16 },
                    { x: -32, z: 12, w: 2, d: 18 },
                    { x: 30, z: -28, w: 2, d: 16 },
                    { x: 30, z: 12, w: 2, d: 18 },
                    { x: -20, z: -18, w: 12, d: 2 },
                    { x: -20, z: -16, w: 2, d: 10 },
                    { x: 8, z: -18, w: 12, d: 2 },
                    { x: 18, z: -16, w: 2, d: 10 },
                    { x: -12, z: -2, w: 10, d: 2 },
                    { x: 2, z: -2, w: 10, d: 2 },
                    { x: -20, z: 14, w: 12, d: 2 },
                    { x: -20, z: 8, w: 2, d: 8 },
                    { x: 8, z: 14, w: 12, d: 2 },
                    { x: 18, z: 8, w: 2, d: 8 },
                    { x: -8, z: -12, w: 3, d: 3 },
                    { x: 6, z: 8, w: 3, d: 3 },
                    { x: -15, z: 22, w: 4, d: 3 },
                    { x: 12, z: -25, w: 3, d: 4 }
                ]
            },
            {
                name: "Neon Grid",
                spawns: { seeker: { x: -20, z: -20 }, hider: { x: 20, z: 20 } },
                style: { floor: 0x0a0a15, wall: 0x00ffff, wallGlow: 0x00ffff, sky: 0x050510 },
                theme: 'neon',
                walls: [
                    { x: -28, z: 20, w: 18, d: 2 },
                    { x: 10, z: 20, w: 18, d: 2 },
                    { x: -20, z: 8, w: 14, d: 2 },
                    { x: 6, z: 8, w: 14, d: 2 },
                    { x: -8, z: -2, w: 16, d: 2 },
                    { x: -20, z: -12, w: 14, d: 2 },
                    { x: 6, z: -12, w: 14, d: 2 },
                    { x: -28, z: -24, w: 18, d: 2 },
                    { x: 10, z: -24, w: 18, d: 2 },
                    { x: -22, z: -20, w: 2, d: 12 },
                    { x: -22, z: 10, w: 2, d: 12 },
                    { x: 20, z: -20, w: 2, d: 12 },
                    { x: 20, z: 10, w: 2, d: 12 },
                    { x: -8, z: -8, w: 2, d: 10 },
                    { x: 6, z: -2, w: 2, d: 10 }
                ]
            },
            {
                name: "The Fortress",
                spawns: { seeker: { x: -25, z: -25 }, hider: { x: 25, z: 25 } },
                style: { floor: 0x3d3d3d, wall: 0x8b7355, wallHighlight: 0xc9a959, sky: 0x2a1a0a },
                theme: 'medieval',
                walls: [
                    { x: -32, z: -30, w: 18, d: 3 },
                    { x: 14, z: -30, w: 18, d: 3 },
                    { x: -32, z: 28, w: 18, d: 3 },
                    { x: 14, z: 28, w: 18, d: 3 },
                    { x: -32, z: -27, w: 3, d: 10 },
                    { x: -32, z: 18, w: 3, d: 12 },
                    { x: 29, z: -27, w: 3, d: 10 },
                    { x: 29, z: 18, w: 3, d: 12 },
                    { x: -12, z: -12, w: 14, d: 2 },
                    { x: -12, z: 10, w: 14, d: 2 },
                    { x: -12, z: -10, w: 2, d: 10 },
                    { x: 10, z: 2, w: 2, d: 10 },
                    { x: -25, z: -15, w: 8, d: 2 },
                    { x: 17, z: -15, w: 8, d: 2 },
                    { x: -25, z: 15, w: 8, d: 2 },
                    { x: 17, z: 15, w: 8, d: 2 },
                    { x: -20, z: -20, w: 3, d: 3 },
                    { x: 18, z: -20, w: 3, d: 3 },
                    { x: -20, z: 18, w: 3, d: 3 },
                    { x: 18, z: 18, w: 3, d: 3 }
                ]
            },
            {
                name: "The Spiral",
                spawns: { seeker: { x: -25, z: -25 }, hider: { x: 25, z: 25 } },
                style: { floor: 0x1a0a2e, wall: 0xff00ff, wallGlow: 0xff00ff, sky: 0x0f0520 },
                theme: 'psychedelic',
                walls: [
                    { x: -28, z: -28, w: 16, d: 2 },
                    { x: -28, z: -26, w: 2, d: 14 },
                    { x: 12, z: -28, w: 16, d: 2 },
                    { x: 26, z: -26, w: 2, d: 14 },
                    { x: -20, z: -8, w: 12, d: 2 },
                    { x: -20, z: -6, w: 2, d: 12 },
                    { x: 8, z: -8, w: 12, d: 2 },
                    { x: 18, z: -6, w: 2, d: 12 },
                    { x: -10, z: 2, w: 10, d: 2 },
                    { x: 2, z: 2, w: 10, d: 2 },
                    { x: -28, z: 12, w: 14, d: 2 },
                    { x: -28, z: 14, w: 2, d: 14 },
                    { x: 14, z: 12, w: 14, d: 2 },
                    { x: 26, z: 14, w: 2, d: 14 },
                    { x: -20, z: 26, w: 14, d: 2 },
                    { x: 6, z: 26, w: 14, d: 2 }
                ]
            },
            {
                name: "The Bunker",
                spawns: { seeker: { x: -25, z: -25 }, hider: { x: 25, z: 25 } },
                style: { floor: 0x2a2a2a, wall: 0x4a4a4a, wallHighlight: 0x666666, sky: 0x1a1a1a },
                theme: 'bunker',
                walls: [
                    { x: -32, z: -30, w: 20, d: 2 },
                    { x: 12, z: -30, w: 20, d: 2 },
                    { x: -32, z: 28, w: 20, d: 2 },
                    { x: 12, z: 28, w: 20, d: 2 },
                    { x: -32, z: -28, w: 2, d: 18 },
                    { x: -32, z: 12, w: 2, d: 18 },
                    { x: 30, z: -28, w: 2, d: 18 },
                    { x: 30, z: 12, w: 2, d: 18 },
                    { x: -22, z: -18, w: 12, d: 2 },
                    { x: -22, z: -16, w: 2, d: 8 },
                    { x: 10, z: -18, w: 12, d: 2 },
                    { x: 20, z: -16, w: 2, d: 8 },
                    { x: -8, z: -5, w: 16, d: 2 },
                    { x: -8, z: 5, w: 16, d: 2 },
                    { x: -22, z: 16, w: 12, d: 2 },
                    { x: -22, z: 10, w: 2, d: 8 },
                    { x: 10, z: 16, w: 12, d: 2 },
                    { x: 20, z: 10, w: 2, d: 8 },
                    { x: -5, z: -15, w: 4, d: 4 },
                    { x: 2, z: 12, w: 4, d: 4 }
                ]
            },
            {
                name: "The Ruins",
                spawns: { seeker: { x: -25, z: -25 }, hider: { x: 25, z: 25 } },
                style: { floor: 0x3d4a3d, wall: 0x6b8e6b, wallHighlight: 0x90ee90, sky: 0x4a6a4a },
                theme: 'ruins',
                walls: [
                    { x: -30, z: -28, w: 18, d: 2 },
                    { x: -5, z: -30, w: 15, d: 2 },
                    { x: 18, z: -28, w: 12, d: 2 },
                    { x: -28, z: 25, w: 15, d: 2 },
                    { x: -5, z: 28, w: 20, d: 2 },
                    { x: 20, z: 26, w: 10, d: 2 },
                    { x: -30, z: -25, w: 2, d: 15 },
                    { x: -32, z: 0, w: 2, d: 18 },
                    { x: 28, z: -22, w: 2, d: 12 },
                    { x: 30, z: 5, w: 2, d: 20 },
                    { x: -22, z: -18, w: 12, d: 2 },
                    { x: 5, z: -20, w: 15, d: 2 },
                    { x: -18, z: -8, w: 15, d: 2 },
                    { x: 8, z: -10, w: 12, d: 2 },
                    { x: -25, z: 2, w: 10, d: 2 },
                    { x: -5, z: 0, w: 18, d: 2 },
                    { x: 18, z: -2, w: 10, d: 2 },
                    { x: -20, z: 12, w: 12, d: 2 },
                    { x: 0, z: 10, w: 15, d: 2 },
                    { x: 20, z: 12, w: 8, d: 2 },
                    { x: -15, z: 20, w: 10, d: 2 },
                    { x: 5, z: 18, w: 12, d: 2 },
                    { x: -20, z: -25, w: 2, d: 10 },
                    { x: -8, z: -22, w: 2, d: 15 },
                    { x: 10, z: -25, w: 2, d: 8 },
                    { x: 22, z: -18, w: 2, d: 12 },
                    { x: -25, z: -5, w: 2, d: 12 },
                    { x: -12, z: 5, w: 2, d: 15 },
                    { x: 5, z: -5, w: 2, d: 18 },
                    { x: 25, z: 5, w: 2, d: 15 },
                    { x: -18, z: 15, w: 2, d: 10 },
                    { x: 12, z: 12, w: 2, d: 12 }
                ]
            },
            {
                name: "The Arena",
                spawns: { seeker: { x: -25, z: -25 }, hider: { x: 25, z: 25 } },
                style: { floor: 0x2d5a2d, wall: 0xffffff, wallHighlight: 0xffff00, sky: 0x1a1a2e },
                theme: 'arena',
                walls: [
                    { x: -32, z: -28, w: 18, d: 2 },
                    { x: 14, z: -28, w: 18, d: 2 },
                    { x: -32, z: 26, w: 18, d: 2 },
                    { x: 14, z: 26, w: 18, d: 2 },
                    { x: -32, z: -26, w: 2, d: 16 },
                    { x: -32, z: 12, w: 2, d: 16 },
                    { x: 30, z: -26, w: 2, d: 16 },
                    { x: 30, z: 12, w: 2, d: 16 },
                    { x: -24, z: -14, w: 14, d: 2 },
                    { x: 10, z: -14, w: 14, d: 2 },
                    { x: -24, z: 12, w: 14, d: 2 },
                    { x: 10, z: 12, w: 14, d: 2 },
                    { x: -8, z: -4, w: 4, d: 4 },
                    { x: 4, z: -4, w: 4, d: 4 },
                    { x: -2, z: 6, w: 4, d: 4 },
                    { x: -22, z: -22, w: 4, d: 4 },
                    { x: 18, z: -22, w: 4, d: 4 },
                    { x: -22, z: 18, w: 4, d: 4 },
                    { x: 18, z: 18, w: 4, d: 4 }
                ]
            },
            {
                name: "The Void",
                spawns: { seeker: { x: -25, z: -25 }, hider: { x: 25, z: 25 } },
                style: { floor: 0x000000, wall: 0x4400ff, wallGlow: 0x8800ff, sky: 0x000011 },
                theme: 'void',
                walls: [
                    { x: -28, z: -28, w: 6, d: 6 },
                    { x: -15, z: -30, w: 4, d: 4 },
                    { x: 5, z: -28, w: 5, d: 5 },
                    { x: 20, z: -32, w: 4, d: 4 },
                    { x: 30, z: -25, w: 5, d: 5 },
                    { x: -32, z: -15, w: 5, d: 5 },
                    { x: -25, z: -8, w: 6, d: 3 },
                    { x: -18, z: -18, w: 4, d: 8 },
                    { x: -12, z: -12, w: 8, d: 3 },
                    { x: -12, z: -5, w: 3, d: 10 },
                    { x: -5, z: 2, w: 10, d: 3 },
                    { x: 5, z: -8, w: 3, d: 12 },
                    { x: 8, z: -12, w: 8, d: 3 },
                    { x: 25, z: -12, w: 5, d: 5 },
                    { x: 32, z: -5, w: 4, d: 6 },
                    { x: 18, z: 0, w: 6, d: 4 },
                    { x: -30, z: 5, w: 5, d: 5 },
                    { x: -20, z: 12, w: 4, d: 4 },
                    { x: -28, z: 22, w: 6, d: 6 },
                    { x: -12, z: 18, w: 8, d: 3 },
                    { x: -5, z: 12, w: 3, d: 10 },
                    { x: 8, z: 8, w: 3, d: 10 },
                    { x: 12, z: 15, w: 10, d: 3 },
                    { x: 22, z: 10, w: 4, d: 4 },
                    { x: 30, z: 15, w: 5, d: 5 },
                    { x: -15, z: 28, w: 5, d: 4 },
                    { x: 0, z: 25, w: 6, d: 6 },
                    { x: 15, z: 30, w: 5, d: 4 },
                    { x: 28, z: 25, w: 5, d: 5 }
                ]
            },
            {
                name: "The Streets",
                spawns: { seeker: { x: -28, z: 0 }, hider: { x: 28, z: 0 } },
                style: { floor: 0x333333, wall: 0x8b4513, sky: 0x1a1a2e },
                theme: 'streets',
                walls: [
                    { x: -32, z: -30, w: 8, d: 12, type: 'brick' },
                    { x: -32, z: -10, w: 6, d: 8, type: 'brick' },
                    { x: -28, z: 8, w: 10, d: 14, type: 'graffiti' },
                    { x: -32, z: 28, w: 8, d: 10, type: 'brick' },
                    { x: 24, z: -32, w: 10, d: 10, type: 'brick' },
                    { x: 28, z: -15, w: 8, d: 8, type: 'graffiti' },
                    { x: 24, z: 5, w: 10, d: 12, type: 'brick' },
                    { x: 28, z: 25, w: 8, d: 12, type: 'graffiti' },
                    { x: -18, z: -20, w: 14, d: 2, type: 'brick' },
                    { x: 5, z: -22, w: 12, d: 2, type: 'graffiti' },
                    { x: -12, z: -5, w: 16, d: 2, type: 'brick' },
                    { x: 8, z: -8, w: 10, d: 2, type: 'graffiti' },
                    { x: -15, z: 10, w: 12, d: 2, type: 'brick' },
                    { x: 6, z: 12, w: 10, d: 2, type: 'graffiti' },
                    { x: -10, z: 25, w: 14, d: 2, type: 'brick' },
                    { x: -18, z: -30, w: 2, d: 10 },
                    { x: -8, z: -28, w: 2, d: 8 },
                    { x: 10, z: -32, w: 2, d: 10 },
                    { x: -20, z: 20, w: 2, d: 12 },
                    { x: 0, z: 18, w: 2, d: 10 },
                    { x: 15, z: 22, w: 2, d: 10 },
                    { x: -25, z: -22, w: 4, d: 3, type: 'dumpster' },
                    { x: 18, z: -28, w: 4, d: 3, type: 'dumpster' },
                    { x: -22, z: 0, w: 4, d: 3, type: 'dumpster' },
                    { x: 20, z: 18, w: 4, d: 3, type: 'dumpster' },
                    { x: -5, z: -15, w: 3, d: 3, type: 'crate' },
                    { x: -15, z: 5, w: 3, d: 3, type: 'crate' },
                    { x: 12, z: 2, w: 3, d: 3, type: 'crate' },
                    { x: 5, z: 28, w: 3, d: 3, type: 'crate' }
                ]
            },
            {
                name: "The Park",
                spawns: { seeker: { x: -28, z: -28 }, hider: { x: 28, z: 28 } },
                style: { floor: 0x228b22, wall: 0x8b4513, sky: 0x87CEEB },
                theme: 'park',
                walls: [
                    { x: 25, z: -28, w: 4, d: 4, type: 'tree' },
                    { x: 30, z: -20, w: 3, d: 3, type: 'tree' },
                    { x: 20, z: -22, w: 3, d: 3, type: 'tree' },
                    { x: -28, z: -25, w: 4, d: 4, type: 'tree' },
                    { x: -32, z: -18, w: 3, d: 3, type: 'tree' },
                    { x: -22, z: -20, w: 3, d: 3, type: 'tree' },
                    { x: 28, z: 25, w: 4, d: 4, type: 'tree' },
                    { x: 22, z: 30, w: 3, d: 3, type: 'tree' },
                    { x: 32, z: 18, w: 3, d: 3, type: 'tree' },
                    { x: -25, z: 28, w: 4, d: 4, type: 'tree' },
                    { x: -30, z: 22, w: 3, d: 3, type: 'tree' },
                    { x: -20, z: 32, w: 3, d: 3, type: 'tree' },
                    { x: -5, z: -5, w: 4, d: 4, type: 'tree' },
                    { x: 5, z: 5, w: 4, d: 4, type: 'tree' },
                    { x: -8, z: 8, w: 3, d: 3, type: 'tree' },
                    { x: 8, z: -8, w: 3, d: 3, type: 'tree' },
                    { x: -18, z: -10, w: 12, d: 2, type: 'bush' },
                    { x: 8, z: -12, w: 14, d: 2, type: 'bush' },
                    { x: -15, z: 12, w: 10, d: 2, type: 'bush' },
                    { x: 10, z: 10, w: 12, d: 2, type: 'bush' },
                    { x: -15, z: -20, w: 2, d: 10, type: 'bush' },
                    { x: 12, z: -25, w: 2, d: 12, type: 'bush' },
                    { x: -18, z: 20, w: 2, d: 12, type: 'bush' },
                    { x: 15, z: 18, w: 2, d: 10, type: 'bush' },
                    { x: -25, z: 0, w: 5, d: 2, type: 'bench' },
                    { x: 25, z: 0, w: 5, d: 2, type: 'bench' },
                    { x: 0, z: -25, w: 5, d: 2, type: 'bench' },
                    { x: 0, z: 25, w: 5, d: 2, type: 'bench' },
                    { x: -10, z: -28, w: 3, d: 3, type: 'bush' },
                    { x: 10, z: 28, w: 3, d: 3, type: 'bush' },
                    { x: -32, z: 5, w: 3, d: 3, type: 'bush' },
                    { x: 32, z: -5, w: 3, d: 3, type: 'bush' }
                ]
            },
            {
                name: "The Bathroom",
                spawns: { seeker: { x: -30, z: -30 }, hider: { x: 30, z: 30 } },
                style: { floor: 0xe8e8f0, wall: 0x87ceeb, sky: 0xe6f3ff },
                theme: 'bathroom',
                walls: [
                    { x: 0, z: 0, w: 12, d: 12, type: 'rubberducky' },
                    { x: 22, z: 22, w: 14, d: 10, type: 'bathtub' },
                    { x: 28, z: -22, w: 10, d: 12, type: 'shower' },
                    { x: 20, z: -22, w: 1, d: 12, type: 'glass' },
                    { x: 28, z: -14, w: 10, d: 1, type: 'glass' },
                    { x: -30, z: -25, w: 6, d: 6, type: 'toilet' },
                    { x: -30, z: -10, w: 6, d: 6, type: 'toilet' },
                    { x: -30, z: 5, w: 6, d: 6, type: 'toilet' },
                    { x: -22, z: -18, w: 2, d: 20, type: 'stalldivider' },
                    { x: -22, z: -32, w: 5, d: 4, type: 'sink' },
                    { x: -10, z: -32, w: 5, d: 4, type: 'sink' },
                    { x: 2, z: -32, w: 5, d: 4, type: 'sink' },
                    { x: 15, z: -5, w: 3, d: 2, type: 'soap' },
                    { x: -15, z: 20, w: 3, d: 2, type: 'soap' },
                    { x: 32, z: 0, w: 2, d: 8, type: 'towelrack' },
                    { x: -20, z: 25, w: 4, d: 4, type: 'tptower' },
                    { x: 10, z: 28, w: 5, d: 5, type: 'laundrybasket' },
                    { x: -5, z: 15, w: 4, d: 4, type: 'puddle' },
                    { x: 20, z: -5, w: 3, d: 3, type: 'puddle' }
                ]
            },
            {
                name: "The Kitchen",
                spawns: { seeker: { x: -25, z: -25 }, hider: { x: 25, z: 25 } },
                style: { floor: 0xdeb887, wall: 0xffffff, sky: 0xfff8dc },
                theme: 'kitchen',
                walls: [
                    { x: -32, z: -25, w: 6, d: 20, type: 'counter' },
                    { x: -28, z: 0, w: 8, d: 8, type: 'fridge' },
                    { x: -32, z: 12, w: 6, d: 10, type: 'counter' },
                    { x: -20, z: -32, w: 12, d: 6, type: 'counter' },
                    { x: -5, z: -30, w: 10, d: 8, type: 'counter' },
                    { x: 12, z: -32, w: 14, d: 6, type: 'counter' },
                    { x: 28, z: -22, w: 8, d: 10, type: 'counter' },
                    { x: 30, z: -8, w: 6, d: 8, type: 'toaster' },
                    { x: 28, z: 5, w: 8, d: 8, type: 'counter' },
                    { x: 30, z: 18, w: 6, d: 12, type: 'counter' },
                    { x: -8, z: -10, w: 12, d: 6, type: 'counter' },
                    { x: 8, z: -5, w: 10, d: 6, type: 'counter' },
                    { x: -15, z: 20, w: 14, d: 8, type: 'counter' },
                    { x: 5, z: 25, w: 12, d: 6, type: 'counter' },
                    { x: -22, z: 16, w: 2, d: 2 },
                    { x: -22, z: 28, w: 2, d: 2 },
                    { x: -8, z: 16, w: 2, d: 2 },
                    { x: -8, z: 28, w: 2, d: 2 },
                    { x: 12, z: 22, w: 2, d: 2 },
                    { x: 12, z: 30, w: 2, d: 2 },
                    { x: 18, z: -18, w: 4, d: 3, type: 'cerealbox' },
                    { x: 22, z: -25, w: 3, d: 3, type: 'cerealbox' },
                    { x: -18, z: -20, w: 3, d: 3, type: 'fruit' },
                    { x: -20, z: 8, w: 4, d: 4, type: 'mug' },
                    { x: 15, z: 12, w: 4, d: 4, type: 'mug' },
                    { x: 0, z: 8, w: 5, d: 5, type: 'puddle' },
                    { x: -12, z: -22, w: 3, d: 3, type: 'fruit' },
                    { x: 10, z: -20, w: 3, d: 3 },
                    { x: 20, z: 28, w: 4, d: 4 }
                ]
            }
        ];

        // Coin spawn positions (same positions used in game)
        const COIN_POSITIONS = [
            { x: 0, z: 0 },
            { x: -20, z: -20 }, { x: 20, z: -20 }, { x: -20, z: 20 }, { x: 20, z: 20 },
            { x: 0, z: -25 }, { x: 0, z: 25 }, { x: -25, z: 0 }, { x: 25, z: 0 },
            { x: -15, z: -10 }, { x: 15, z: -10 }, { x: -15, z: 10 }, { x: 15, z: 10 },
            { x: -10, z: -15 }, { x: 10, z: -15 }, { x: -10, z: 15 }, { x: 10, z: 15 }
        ];

        // Powerup spawn positions
        const POWERUP_POSITIONS = [
            { x: -30, z: 0 }, { x: 30, z: 0 }, { x: 0, z: -30 }, { x: 0, z: 30 },
            { x: -20, z: -20 }, { x: 20, z: 20 }
        ];

        let modalScene, modalCamera, modalRenderer, currentBoardIndex = 0;

        function createBoardPreview(board, index) {
            const card = document.createElement('div');
            card.className = 'board-card';
            card.onclick = () => openModal(index);
            card.innerHTML = `
                <h3>${index + 1}. ${board.name}</h3>
                <canvas id="canvas-${index}"></canvas>
                <div class="board-info">
                    <span>Theme: ${board.theme}</span>
                    <span>Walls: ${board.walls.length}</span>
                </div>
                <div class="click-hint">Click to view details</div>
            `;
            document.getElementById('grid').appendChild(card);

            const canvas = document.getElementById(`canvas-${index}`);
            const width = canvas.clientWidth || 300;
            const height = 220;

            const scene = new THREE.Scene();
            scene.background = new THREE.Color(board.style.sky || 0x1a1a2e);

            const camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 1000);
            camera.position.set(0, 70, 35);
            camera.lookAt(0, 0, 0);

            const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            renderer.setSize(width, height);

            addSceneElements(scene, board, false);
            renderer.render(scene, camera);
        }

        function addSceneElements(scene, board, showDetails) {
            // Lighting
            const ambient = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambient);
            const directional = new THREE.DirectionalLight(0xffffff, 0.8);
            directional.position.set(10, 20, 10);
            scene.add(directional);

            // Floor
            const floorGeometry = new THREE.CircleGeometry(CONFIG.ARENA_RADIUS, 64);
            const floorMaterial = new THREE.MeshStandardMaterial({ color: board.style.floor, roughness: 0.8 });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            scene.add(floor);

            // Arena boundary ring
            const boundaryGeometry = new THREE.RingGeometry(CONFIG.ARENA_RADIUS - 0.5, CONFIG.ARENA_RADIUS + 1, 64);
            const boundaryMaterial = new THREE.MeshBasicMaterial({ color: board.style.wall, side: THREE.DoubleSide });
            const boundary = new THREE.Mesh(boundaryGeometry, boundaryMaterial);
            boundary.rotation.x = -Math.PI / 2;
            boundary.position.y = 0.1;
            scene.add(boundary);

            // Walls
            board.walls.forEach(wall => {
                const geometry = new THREE.BoxGeometry(wall.w, CONFIG.WALL_HEIGHT, wall.d);
                const material = new THREE.MeshStandardMaterial({
                    color: board.style.wall,
                    roughness: 0.7,
                    metalness: 0.1,
                    emissive: board.theme === 'neon' || board.theme === 'void' ? board.style.wall : 0x000000,
                    emissiveIntensity: board.theme === 'neon' || board.theme === 'void' ? 0.3 : 0
                });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(wall.x + wall.w / 2, CONFIG.WALL_HEIGHT / 2, wall.z + wall.d / 2);
                scene.add(mesh);

                const edgeGeometry = new THREE.EdgesGeometry(geometry);
                const edgeMaterial = new THREE.LineBasicMaterial({ color: 0xffffff, opacity: 0.3, transparent: true });
                const edges = new THREE.LineSegments(edgeGeometry, edgeMaterial);
                edges.position.copy(mesh.position);
                scene.add(edges);
            });

            // Portals
            const portalGeom = new THREE.CylinderGeometry(3, 3, 0.5, 16);
            const leftPortalMat = new THREE.MeshBasicMaterial({ color: 0x00ff00, transparent: true, opacity: 0.8 });
            const leftPortal = new THREE.Mesh(portalGeom, leftPortalMat);
            leftPortal.position.set(-37, 0.3, 0);
            scene.add(leftPortal);

            // Portal glow ring
            const ringGeom = new THREE.RingGeometry(3, 4, 32);
            const leftRing = new THREE.Mesh(ringGeom, new THREE.MeshBasicMaterial({ color: 0x00ff00, transparent: true, opacity: 0.5, side: THREE.DoubleSide }));
            leftRing.rotation.x = -Math.PI / 2;
            leftRing.position.set(-37, 0.5, 0);
            scene.add(leftRing);

            const rightPortalMat = new THREE.MeshBasicMaterial({ color: 0xff0000, transparent: true, opacity: 0.8 });
            const rightPortal = new THREE.Mesh(portalGeom, rightPortalMat);
            rightPortal.position.set(37, 0.3, 0);
            scene.add(rightPortal);

            const rightRing = new THREE.Mesh(ringGeom, new THREE.MeshBasicMaterial({ color: 0xff0000, transparent: true, opacity: 0.5, side: THREE.DoubleSide }));
            rightRing.rotation.x = -Math.PI / 2;
            rightRing.position.set(37, 0.5, 0);
            scene.add(rightRing);

            // Spawn points
            const spawnGeom = new THREE.SphereGeometry(1.5, 16, 16);
            const seekerSpawn = new THREE.Mesh(spawnGeom, new THREE.MeshBasicMaterial({ color: 0xff4444 }));
            seekerSpawn.position.set(-25, 1.5, -25);
            scene.add(seekerSpawn);

            const hiderSpawn = new THREE.Mesh(spawnGeom, new THREE.MeshBasicMaterial({ color: 0x44ff44 }));
            hiderSpawn.position.set(25, 1.5, 25);
            scene.add(hiderSpawn);

            if (showDetails) {
                // Coins
                const coinGeom = new THREE.CylinderGeometry(0.8, 0.8, 0.3, 16);
                const coinMat = new THREE.MeshBasicMaterial({ color: 0xffd700 });
                COIN_POSITIONS.forEach(pos => {
                    const coin = new THREE.Mesh(coinGeom, coinMat);
                    coin.position.set(pos.x, 1, pos.z);
                    coin.rotation.x = Math.PI / 2;
                    scene.add(coin);
                });

                // Powerup spawns
                const powerupGeom = new THREE.OctahedronGeometry(1.2);
                const powerupMat = new THREE.MeshBasicMaterial({ color: 0xff00ff, transparent: true, opacity: 0.7 });
                POWERUP_POSITIONS.forEach(pos => {
                    const powerup = new THREE.Mesh(powerupGeom, powerupMat);
                    powerup.position.set(pos.x, 2, pos.z);
                    scene.add(powerup);
                });

                // Grid helper for reference
                const gridHelper = new THREE.GridHelper(80, 16, 0x444444, 0x222222);
                gridHelper.position.y = 0.05;
                scene.add(gridHelper);

                // Add theme-specific decorations
                addThemeDecorations(scene, board);
            }
        }

        function addThemeDecorations(scene, board) {
            switch(board.theme) {
                case 'haunted':
                    addHauntedDecorations(scene);
                    break;
                case 'garden':
                    addGardenDecorations(scene);
                    break;
                case 'medieval':
                    addMedievalDecorations(scene);
                    break;
                case 'neon':
                case 'void':
                    addNeonDecorations(scene, board);
                    break;
                case 'bunker':
                    addBunkerDecorations(scene);
                    break;
                case 'ruins':
                    addRuinsDecorations(scene);
                    break;
                case 'arena':
                    addArenaDecorations(scene);
                    break;
                case 'streets':
                    addStreetsDecorations(scene);
                    break;
                case 'park':
                    addParkDecorations(scene);
                    break;
                case 'bathroom':
                    addBathroomDecorations(scene);
                    break;
                case 'psychedelic':
                    addPsychedelicDecorations(scene);
                    break;
                case 'kitchen':
                    addKitchenDecorations(scene);
                    break;
            }
        }

        function addHauntedDecorations(scene) {
            // Flickering light bulb
            const bulbGeometry = new THREE.SphereGeometry(0.4, 8, 8);
            const bulbMaterial = new THREE.MeshBasicMaterial({ color: 0xffdd88 });
            const bulbMesh = new THREE.Mesh(bulbGeometry, bulbMaterial);
            bulbMesh.position.set(0, 6, 0);
            scene.add(bulbMesh);

            // Wire
            const wireGeometry = new THREE.CylinderGeometry(0.05, 0.05, 2, 8);
            const wireMaterial = new THREE.MeshBasicMaterial({ color: 0x222222 });
            const wire = new THREE.Mesh(wireGeometry, wireMaterial);
            wire.position.set(0, 7.5, 0);
            scene.add(wire);

            // Floating ghosts
            const ghostPositions = [
                { x: -20, z: 20 }, { x: 22, z: -18 }, { x: -15, z: -22 }, { x: 18, z: 15 }
            ];
            ghostPositions.forEach(pos => {
                const ghostGroup = new THREE.Group();
                const bodyGeom = new THREE.SphereGeometry(1.2, 8, 8);
                bodyGeom.scale(1, 1.5, 0.8);
                const ghostMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.5 });
                const body = new THREE.Mesh(bodyGeom, ghostMat);
                ghostGroup.add(body);

                // Eyes
                const eyeGeom = new THREE.CircleGeometry(0.2, 8);
                const eyeMat = new THREE.MeshBasicMaterial({ color: 0x000000, side: THREE.DoubleSide });
                const leftEye = new THREE.Mesh(eyeGeom, eyeMat);
                leftEye.position.set(-0.35, 0.4, 0.9);
                ghostGroup.add(leftEye);
                const rightEye = new THREE.Mesh(eyeGeom, eyeMat);
                rightEye.position.set(0.35, 0.4, 0.9);
                ghostGroup.add(rightEye);

                // Mouth
                const mouthGeom = new THREE.CircleGeometry(0.3, 8);
                mouthGeom.scale(1, 1.5, 1);
                const mouth = new THREE.Mesh(mouthGeom, eyeMat);
                mouth.position.set(0, -0.3, 0.9);
                ghostGroup.add(mouth);

                // Tail
                const tailGeom = new THREE.ConeGeometry(1.2, 1.5, 8);
                const tail = new THREE.Mesh(tailGeom, ghostMat);
                tail.position.y = -1.8;
                tail.rotation.x = Math.PI;
                ghostGroup.add(tail);

                ghostGroup.position.set(pos.x, 5, pos.z);
                scene.add(ghostGroup);
            });

            // Cobwebs
            const cobwebPositions = [
                { x: -28, z: -28, rot: 0 }, { x: 28, z: -28, rot: Math.PI / 2 },
                { x: -28, z: 28, rot: -Math.PI / 2 }, { x: 28, z: 28, rot: Math.PI }
            ];
            cobwebPositions.forEach(pos => {
                const webGroup = new THREE.Group();
                const webMat = new THREE.LineBasicMaterial({ color: 0xcccccc, transparent: true, opacity: 0.6 });
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI / 2;
                    const points = [
                        new THREE.Vector3(0, 0, 0),
                        new THREE.Vector3(Math.cos(angle) * 3, Math.sin(angle) * 3, 0)
                    ];
                    const lineGeom = new THREE.BufferGeometry().setFromPoints(points);
                    webGroup.add(new THREE.Line(lineGeom, webMat));
                }
                for (let ring = 1; ring <= 4; ring++) {
                    const ringPoints = [];
                    for (let i = 0; i <= 8; i++) {
                        const angle = (i / 8) * Math.PI / 2;
                        ringPoints.push(new THREE.Vector3(Math.cos(angle) * ring * 0.7, Math.sin(angle) * ring * 0.7, 0));
                    }
                    const ringGeom = new THREE.BufferGeometry().setFromPoints(ringPoints);
                    webGroup.add(new THREE.Line(ringGeom, webMat));
                }
                webGroup.position.set(pos.x, 5, pos.z);
                webGroup.rotation.x = -Math.PI / 2;
                webGroup.rotation.z = pos.rot;
                scene.add(webGroup);
            });

            // Blood splatters
            const bloodPositions = [
                { x: -30, z: 0, rotY: Math.PI / 2 },
                { x: 30, z: -10, rotY: -Math.PI / 2 },
                { x: 5, z: -28, rotY: 0 },
                { x: -10, z: 28, rotY: Math.PI }
            ];
            bloodPositions.forEach(pos => {
                const splatGeom = new THREE.CircleGeometry(1.5, 12);
                splatGeom.scale(1, 1.3, 1);
                const bloodMat = new THREE.MeshBasicMaterial({ color: 0x8b0000, transparent: true, opacity: 0.8, side: THREE.DoubleSide });
                const splat = new THREE.Mesh(splatGeom, bloodMat);
                splat.position.set(pos.x, 2.5, pos.z);
                splat.rotation.y = pos.rotY;
                scene.add(splat);

                // Drips
                for (let d = 0; d < 3; d++) {
                    const dripGeom = new THREE.CylinderGeometry(0.15, 0.08, 1.5 + Math.random(), 8);
                    const drip = new THREE.Mesh(dripGeom, bloodMat);
                    drip.position.set(
                        pos.x + (pos.rotY === 0 || pos.rotY === Math.PI ? (Math.random() - 0.5) * 2 : 0),
                        1.2,
                        pos.z + (Math.abs(pos.rotY) === Math.PI / 2 ? (Math.random() - 0.5) * 2 : 0)
                    );
                    scene.add(drip);
                }
            });

            // Crates and barrels
            addCrate(scene, -25, 10, 2.5, 0x3d2817);
            addCrate(scene, 25, -15, 2, 0x3d2817);
            addBarrel(scene, -10, 25, 1.2, 2.5, 0x2d1f1a);
            addBarrel(scene, 15, 20, 1, 2, 0x1a1a1a);
        }

        function addGardenDecorations(scene) {
            // Trees
            const treePositions = [
                { x: -25, z: -25 }, { x: 25, z: -25 }, { x: -25, z: 25 }, { x: 25, z: 25 },
                { x: 0, z: -30 }, { x: 0, z: 30 }, { x: -30, z: 0 }, { x: 30, z: 0 }
            ];
            treePositions.forEach(pos => {
                // Trunk
                const trunkGeom = new THREE.CylinderGeometry(0.5, 0.7, 4, 8);
                const trunkMat = new THREE.MeshStandardMaterial({ color: 0x8b4513 });
                const trunk = new THREE.Mesh(trunkGeom, trunkMat);
                trunk.position.set(pos.x, 2, pos.z);
                scene.add(trunk);

                // Foliage
                const foliageGeom = new THREE.SphereGeometry(2.5, 8, 8);
                const foliageMat = new THREE.MeshStandardMaterial({ color: 0x228b22 });
                const foliage = new THREE.Mesh(foliageGeom, foliageMat);
                foliage.position.set(pos.x, 5.5, pos.z);
                scene.add(foliage);
            });

            // Flowers
            const flowerColors = [0xff69b4, 0xffff00, 0xff4500, 0x9932cc, 0xffffff];
            for (let i = 0; i < 30; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = 10 + Math.random() * 25;
                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;

                const flowerGeom = new THREE.SphereGeometry(0.3, 8, 8);
                const flowerMat = new THREE.MeshBasicMaterial({ color: flowerColors[Math.floor(Math.random() * flowerColors.length)] });
                const flower = new THREE.Mesh(flowerGeom, flowerMat);
                flower.position.set(x, 0.3, z);
                scene.add(flower);
            }

            // Bushes
            const bushPositions = [
                { x: -15, z: 0 }, { x: 15, z: 0 }, { x: 0, z: -15 }, { x: 0, z: 15 }
            ];
            bushPositions.forEach(pos => {
                const bushGeom = new THREE.SphereGeometry(1.5, 8, 8);
                bushGeom.scale(1.2, 0.8, 1.2);
                const bushMat = new THREE.MeshStandardMaterial({ color: 0x2e8b57 });
                const bush = new THREE.Mesh(bushGeom, bushMat);
                bush.position.set(pos.x, 0.8, pos.z);
                scene.add(bush);
            });
        }

        function addMedievalDecorations(scene) {
            // Torches
            const torchPositions = [
                { x: -28, z: -15 }, { x: -28, z: 15 }, { x: 28, z: -15 }, { x: 28, z: 15 },
                { x: -15, z: -28 }, { x: 15, z: -28 }, { x: -15, z: 28 }, { x: 15, z: 28 }
            ];
            torchPositions.forEach(pos => {
                // Torch holder
                const holderGeom = new THREE.CylinderGeometry(0.2, 0.3, 1.5, 8);
                const holderMat = new THREE.MeshStandardMaterial({ color: 0x4a3728 });
                const holder = new THREE.Mesh(holderGeom, holderMat);
                holder.position.set(pos.x, 3, pos.z);
                scene.add(holder);

                // Flame
                const flameGeom = new THREE.ConeGeometry(0.3, 0.8, 8);
                const flameMat = new THREE.MeshBasicMaterial({ color: 0xff6600 });
                const flame = new THREE.Mesh(flameGeom, flameMat);
                flame.position.set(pos.x, 4, pos.z);
                scene.add(flame);
            });

            // Banners/Flags
            const bannerPositions = [{ x: -20, z: 0 }, { x: 20, z: 0 }];
            bannerPositions.forEach(pos => {
                // Pole
                const poleGeom = new THREE.CylinderGeometry(0.1, 0.1, 6, 8);
                const poleMat = new THREE.MeshStandardMaterial({ color: 0x4a3728 });
                const pole = new THREE.Mesh(poleGeom, poleMat);
                pole.position.set(pos.x, 3, pos.z);
                scene.add(pole);

                // Banner
                const bannerGeom = new THREE.PlaneGeometry(2, 3);
                const bannerMat = new THREE.MeshBasicMaterial({ color: 0x8b0000, side: THREE.DoubleSide });
                const banner = new THREE.Mesh(bannerGeom, bannerMat);
                banner.position.set(pos.x + 1.2, 4.5, pos.z);
                scene.add(banner);
            });
        }

        function addNeonDecorations(scene, board) {
            // Glowing grid on floor
            const gridHelper = new THREE.GridHelper(80, 16, board.style.wall, board.style.wall);
            gridHelper.position.y = 0.1;
            gridHelper.material.opacity = 0.5;
            gridHelper.material.transparent = true;
            scene.add(gridHelper);

            // Floating particles
            for (let i = 0; i < 30; i++) {
                const particleGeom = new THREE.SphereGeometry(0.2, 8, 8);
                const particleMat = new THREE.MeshBasicMaterial({ color: board.style.wall, transparent: true, opacity: 0.8 });
                const particle = new THREE.Mesh(particleGeom, particleMat);
                const angle = Math.random() * Math.PI * 2;
                const radius = Math.random() * 30;
                particle.position.set(Math.cos(angle) * radius, 2 + Math.random() * 4, Math.sin(angle) * radius);
                scene.add(particle);
            }
        }

        function addBunkerDecorations(scene) {
            // Industrial lights
            const lightPositions = [
                { x: -15, z: -15 }, { x: 15, z: -15 }, { x: -15, z: 15 }, { x: 15, z: 15 }
            ];
            lightPositions.forEach(pos => {
                const cageGeom = new THREE.BoxGeometry(1, 0.5, 1);
                const cageMat = new THREE.MeshStandardMaterial({ color: 0x333333, wireframe: true });
                const cage = new THREE.Mesh(cageGeom, cageMat);
                cage.position.set(pos.x, 5.5, pos.z);
                scene.add(cage);

                const bulbGeom = new THREE.SphereGeometry(0.3, 8, 8);
                const bulbMat = new THREE.MeshBasicMaterial({ color: 0xffffcc });
                const bulb = new THREE.Mesh(bulbGeom, bulbMat);
                bulb.position.set(pos.x, 5.5, pos.z);
                scene.add(bulb);
            });

            // Metal crates
            addCrate(scene, -20, 0, 2, 0x4a4a4a);
            addCrate(scene, 20, 5, 1.8, 0x3a3a3a);
            addBarrel(scene, 0, -20, 1.2, 2, 0x2a2a2a);
            addBarrel(scene, -5, 18, 1, 1.8, 0x3a3a3a);
        }

        function addRuinsDecorations(scene) {
            // Broken pillars
            const pillarPositions = [
                { x: -20, z: -20, h: 3 }, { x: 20, z: -20, h: 4 },
                { x: -20, z: 20, h: 2 }, { x: 20, z: 20, h: 5 }
            ];
            pillarPositions.forEach(pos => {
                const pillarGeom = new THREE.CylinderGeometry(1, 1.2, pos.h, 8);
                const pillarMat = new THREE.MeshStandardMaterial({ color: 0x808080 });
                const pillar = new THREE.Mesh(pillarGeom, pillarMat);
                pillar.position.set(pos.x, pos.h / 2, pos.z);
                scene.add(pillar);
            });

            // Rubble
            for (let i = 0; i < 20; i++) {
                const rubbleGeom = new THREE.DodecahedronGeometry(0.3 + Math.random() * 0.5);
                const rubbleMat = new THREE.MeshStandardMaterial({ color: 0x696969 });
                const rubble = new THREE.Mesh(rubbleGeom, rubbleMat);
                const angle = Math.random() * Math.PI * 2;
                const radius = 5 + Math.random() * 25;
                rubble.position.set(Math.cos(angle) * radius, 0.3, Math.sin(angle) * radius);
                rubble.rotation.set(Math.random(), Math.random(), Math.random());
                scene.add(rubble);
            }
        }

        function addArenaDecorations(scene) {
            // Spotlights
            const spotPositions = [
                { x: -25, z: -25 }, { x: 25, z: -25 }, { x: -25, z: 25 }, { x: 25, z: 25 }
            ];
            spotPositions.forEach(pos => {
                const spotGeom = new THREE.ConeGeometry(1, 2, 8);
                const spotMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
                const spot = new THREE.Mesh(spotGeom, spotMat);
                spot.position.set(pos.x, 7, pos.z);
                spot.rotation.x = Math.PI;
                scene.add(spot);

                // Light beam
                const beamGeom = new THREE.CylinderGeometry(0.5, 3, 6, 16, 1, true);
                const beamMat = new THREE.MeshBasicMaterial({ color: 0xffffcc, transparent: true, opacity: 0.1, side: THREE.DoubleSide });
                const beam = new THREE.Mesh(beamGeom, beamMat);
                beam.position.set(pos.x, 3, pos.z);
                scene.add(beam);
            });
        }

        function addStreetsDecorations(scene) {
            // Street lamps
            const lampPositions = [
                { x: -25, z: 0 }, { x: 25, z: 0 }, { x: 0, z: -25 }, { x: 0, z: 25 }
            ];
            lampPositions.forEach(pos => {
                const poleGeom = new THREE.CylinderGeometry(0.2, 0.3, 5, 8);
                const poleMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
                const pole = new THREE.Mesh(poleGeom, poleMat);
                pole.position.set(pos.x, 2.5, pos.z);
                scene.add(pole);

                const lampGeom = new THREE.SphereGeometry(0.5, 8, 8);
                const lampMat = new THREE.MeshBasicMaterial({ color: 0xffffaa });
                const lamp = new THREE.Mesh(lampGeom, lampMat);
                lamp.position.set(pos.x, 5.2, pos.z);
                scene.add(lamp);
            });

            // Trash cans
            addBarrel(scene, -18, -18, 0.8, 1.5, 0x2a2a2a);
            addBarrel(scene, 18, 18, 0.8, 1.5, 0x2a2a2a);

            // Graffiti panels
            const graffitiPositions = [
                { x: -29, z: 10, rotY: Math.PI / 2 },
                { x: 29, z: -10, rotY: -Math.PI / 2 }
            ];
            graffitiPositions.forEach(pos => {
                const panelGeom = new THREE.PlaneGeometry(8, 4);
                const panelMat = new THREE.MeshBasicMaterial({ color: 0xff00ff, transparent: true, opacity: 0.6, side: THREE.DoubleSide });
                const panel = new THREE.Mesh(panelGeom, panelMat);
                panel.position.set(pos.x, 3, pos.z);
                panel.rotation.y = pos.rotY;
                scene.add(panel);
            });
        }

        function addParkDecorations(scene) {
            // Pond in center
            const pondGeom = new THREE.CircleGeometry(8, 32);
            const pondMat = new THREE.MeshBasicMaterial({ color: 0x4169e1, transparent: true, opacity: 0.7 });
            const pond = new THREE.Mesh(pondGeom, pondMat);
            pond.rotation.x = -Math.PI / 2;
            pond.position.y = 0.1;
            scene.add(pond);

            // Benches
            const benchPositions = [
                { x: -15, z: -15, rotY: Math.PI / 4 },
                { x: 15, z: 15, rotY: -Math.PI * 3/4 }
            ];
            benchPositions.forEach(pos => {
                const seatGeom = new THREE.BoxGeometry(3, 0.2, 1);
                const benchMat = new THREE.MeshStandardMaterial({ color: 0x8b4513 });
                const seat = new THREE.Mesh(seatGeom, benchMat);
                seat.position.set(pos.x, 0.8, pos.z);
                seat.rotation.y = pos.rotY;
                scene.add(seat);

                const backGeom = new THREE.BoxGeometry(3, 1, 0.2);
                const back = new THREE.Mesh(backGeom, benchMat);
                back.position.set(pos.x - Math.sin(pos.rotY) * 0.4, 1.3, pos.z - Math.cos(pos.rotY) * 0.4);
                back.rotation.y = pos.rotY;
                scene.add(back);
            });

            // Trees around pond
            const treeAngles = [0, Math.PI/2, Math.PI, Math.PI*3/2];
            treeAngles.forEach(angle => {
                const x = Math.cos(angle) * 15;
                const z = Math.sin(angle) * 15;

                const trunkGeom = new THREE.CylinderGeometry(0.4, 0.5, 3, 8);
                const trunkMat = new THREE.MeshStandardMaterial({ color: 0x8b4513 });
                const trunk = new THREE.Mesh(trunkGeom, trunkMat);
                trunk.position.set(x, 1.5, z);
                scene.add(trunk);

                const foliageGeom = new THREE.SphereGeometry(2, 8, 8);
                const foliageMat = new THREE.MeshStandardMaterial({ color: 0x228b22 });
                const foliage = new THREE.Mesh(foliageGeom, foliageMat);
                foliage.position.set(x, 4, z);
                scene.add(foliage);
            });
        }

        function addBathroomDecorations(scene) {
            // Toilets
            const toiletPositions = [
                { x: -20, z: -15 }, { x: -20, z: 0 }, { x: -20, z: 15 }
            ];
            toiletPositions.forEach(pos => {
                // Bowl
                const bowlGeom = new THREE.CylinderGeometry(0.8, 0.6, 1, 16);
                const toiletMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
                const bowl = new THREE.Mesh(bowlGeom, toiletMat);
                bowl.position.set(pos.x, 0.5, pos.z);
                scene.add(bowl);

                // Tank
                const tankGeom = new THREE.BoxGeometry(1.2, 1.5, 0.5);
                const tank = new THREE.Mesh(tankGeom, toiletMat);
                tank.position.set(pos.x - 0.5, 1.25, pos.z);
                scene.add(tank);
            });

            // Sinks
            const sinkPositions = [
                { x: 20, z: -15 }, { x: 20, z: 0 }, { x: 20, z: 15 }
            ];
            sinkPositions.forEach(pos => {
                const sinkGeom = new THREE.BoxGeometry(1.5, 0.3, 1);
                const sinkMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
                const sink = new THREE.Mesh(sinkGeom, sinkMat);
                sink.position.set(pos.x, 2, pos.z);
                scene.add(sink);

                // Mirror
                const mirrorGeom = new THREE.PlaneGeometry(1.5, 2);
                const mirrorMat = new THREE.MeshBasicMaterial({ color: 0xaaddff, side: THREE.DoubleSide });
                const mirror = new THREE.Mesh(mirrorGeom, mirrorMat);
                mirror.position.set(pos.x + 0.9, 3.5, pos.z);
                mirror.rotation.y = -Math.PI / 2;
                scene.add(mirror);
            });

            // Bathtub
            const tubGeom = new THREE.BoxGeometry(4, 1.5, 2);
            const tubMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
            const tub = new THREE.Mesh(tubGeom, tubMat);
            tub.position.set(0, 0.75, -25);
            scene.add(tub);
        }

        function addPsychedelicDecorations(scene) {
            // Colorful floating orbs
            const colors = [0xff0000, 0x00ff00, 0x0000ff, 0xffff00, 0xff00ff, 0x00ffff];
            for (let i = 0; i < 40; i++) {
                const orbGeom = new THREE.SphereGeometry(0.5 + Math.random() * 0.5, 16, 16);
                const orbMat = new THREE.MeshBasicMaterial({
                    color: colors[Math.floor(Math.random() * colors.length)],
                    transparent: true,
                    opacity: 0.6
                });
                const orb = new THREE.Mesh(orbGeom, orbMat);
                const angle = Math.random() * Math.PI * 2;
                const radius = 5 + Math.random() * 30;
                orb.position.set(Math.cos(angle) * radius, 1 + Math.random() * 5, Math.sin(angle) * radius);
                scene.add(orb);
            }
        }

        function addKitchenDecorations(scene) {
            // Overhead kitchen light
            const lightGeom = new THREE.BoxGeometry(8, 0.3, 2);
            const lightMat = new THREE.MeshBasicMaterial({ color: 0xffffcc });
            const light = new THREE.Mesh(lightGeom, lightMat);
            light.position.set(0, 6, 0);
            scene.add(light);

            // Hanging pots and pans
            const potPositions = [
                { x: -10, z: -15 }, { x: -5, z: -15 }, { x: 0, z: -15 }, { x: 5, z: -15 }
            ];
            potPositions.forEach((pos, i) => {
                const potGeom = new THREE.CylinderGeometry(0.6, 0.5, 0.4, 16);
                const potMat = new THREE.MeshStandardMaterial({ color: i % 2 === 0 ? 0x333333 : 0xcd7f32, metalness: 0.8 });
                const pot = new THREE.Mesh(potGeom, potMat);
                pot.position.set(pos.x, 5.5, pos.z);
                scene.add(pot);

                // Hanging wire
                const wireGeom = new THREE.CylinderGeometry(0.02, 0.02, 1, 8);
                const wireMat = new THREE.MeshBasicMaterial({ color: 0x333333 });
                const wire = new THREE.Mesh(wireGeom, wireMat);
                wire.position.set(pos.x, 6.2, pos.z);
                scene.add(wire);
            });

            // Fruit bowl
            const bowlGeom = new THREE.SphereGeometry(1.5, 16, 16, 0, Math.PI * 2, 0, Math.PI / 2);
            const bowlMat = new THREE.MeshStandardMaterial({ color: 0xffffff, side: THREE.DoubleSide });
            const bowl = new THREE.Mesh(bowlGeom, bowlMat);
            bowl.position.set(-5, 0.1, 5);
            bowl.rotation.x = Math.PI;
            scene.add(bowl);

            // Fruits in bowl
            const fruitColors = [0xff0000, 0xffa500, 0xffff00, 0x00ff00];
            fruitColors.forEach((color, i) => {
                const fruitGeom = new THREE.SphereGeometry(0.4, 8, 8);
                const fruitMat = new THREE.MeshStandardMaterial({ color: color });
                const fruit = new THREE.Mesh(fruitGeom, fruitMat);
                fruit.position.set(-5 + (Math.random() - 0.5) * 1.5, 0.8 + i * 0.2, 5 + (Math.random() - 0.5) * 1.5);
                scene.add(fruit);
            });

            // Kitchen utensils in holder
            const holderGeom = new THREE.CylinderGeometry(0.8, 0.7, 2, 16);
            const holderMat = new THREE.MeshStandardMaterial({ color: 0x666666 });
            const holder = new THREE.Mesh(holderGeom, holderMat);
            holder.position.set(15, 1, -20);
            scene.add(holder);

            // Spatula and spoons sticking out
            for (let i = 0; i < 4; i++) {
                const utensilGeom = new THREE.CylinderGeometry(0.08, 0.08, 2.5, 8);
                const utensilMat = new THREE.MeshStandardMaterial({ color: 0x8b4513 });
                const utensil = new THREE.Mesh(utensilGeom, utensilMat);
                utensil.position.set(15 + (Math.random() - 0.5) * 0.6, 2.5, -20 + (Math.random() - 0.5) * 0.6);
                utensil.rotation.x = (Math.random() - 0.5) * 0.3;
                utensil.rotation.z = (Math.random() - 0.5) * 0.3;
                scene.add(utensil);
            }
        }

        // Helper functions
        function addCrate(scene, x, z, size, color) {
            const crateGeom = new THREE.BoxGeometry(size, size, size);
            const crateMat = new THREE.MeshStandardMaterial({ color: color });
            const crate = new THREE.Mesh(crateGeom, crateMat);
            crate.position.set(x, size / 2, z);
            scene.add(crate);

            const edgeGeom = new THREE.EdgesGeometry(crateGeom);
            const edgeMat = new THREE.LineBasicMaterial({ color: 0x000000, opacity: 0.3, transparent: true });
            const edges = new THREE.LineSegments(edgeGeom, edgeMat);
            edges.position.copy(crate.position);
            scene.add(edges);
        }

        function addBarrel(scene, x, z, radius, height, color) {
            const barrelGeom = new THREE.CylinderGeometry(radius, radius, height, 16);
            const barrelMat = new THREE.MeshStandardMaterial({ color: color });
            const barrel = new THREE.Mesh(barrelGeom, barrelMat);
            barrel.position.set(x, height / 2, z);
            scene.add(barrel);
        }

        function openModal(index) {
            currentBoardIndex = index;
            const board = BOARDS[index];

            document.getElementById('modal-title').textContent = `${index + 1}. ${board.name}`;
            document.getElementById('modal').classList.add('active');

            // Board details
            const details = document.getElementById('board-details');
            details.innerHTML = `
                <div class="detail-row">
                    <span class="detail-label">Theme</span>
                    <span class="detail-value">${board.theme}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Wall Count</span>
                    <span class="detail-value">${board.walls.length}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Floor Color</span>
                    <span class="detail-value">
                        #${board.style.floor.toString(16).padStart(6, '0')}
                        <span class="color-swatch" style="background: #${board.style.floor.toString(16).padStart(6, '0')};"></span>
                    </span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Wall Color</span>
                    <span class="detail-value">
                        #${board.style.wall.toString(16).padStart(6, '0')}
                        <span class="color-swatch" style="background: #${board.style.wall.toString(16).padStart(6, '0')};"></span>
                    </span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Sky Color</span>
                    <span class="detail-value">
                        #${board.style.sky.toString(16).padStart(6, '0')}
                        <span class="color-swatch" style="background: #${board.style.sky.toString(16).padStart(6, '0')};"></span>
                    </span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Coin Spawns</span>
                    <span class="detail-value">${COIN_POSITIONS.length}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Powerup Spawns</span>
                    <span class="detail-value">${POWERUP_POSITIONS.length}</span>
                </div>
            `;

            // Create modal scene
            const canvas = document.getElementById('modal-canvas');
            canvas.width = 800;
            canvas.height = 600;

            modalScene = new THREE.Scene();
            modalScene.background = new THREE.Color(board.style.sky || 0x1a1a2e);

            modalCamera = new THREE.PerspectiveCamera(50, 800 / 600, 0.1, 1000);
            modalCamera.position.set(0, 70, 40);
            modalCamera.lookAt(0, 0, 0);

            modalRenderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            modalRenderer.setSize(800, 600);

            addSceneElements(modalScene, board, true);
            modalRenderer.render(modalScene, modalCamera);

            // Reset camera controls
            document.getElementById('cam-height').value = 70;
            document.getElementById('cam-angle').value = 40;
            document.getElementById('cam-rotation').value = 0;
            updateCameraLabels();
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function updateCamera() {
            if (!modalCamera || !modalRenderer) return;

            const height = parseInt(document.getElementById('cam-height').value);
            const angle = parseInt(document.getElementById('cam-angle').value);
            const rotation = parseInt(document.getElementById('cam-rotation').value);

            updateCameraLabels();

            const rotRad = (rotation * Math.PI) / 180;
            const distance = angle;

            modalCamera.position.set(
                Math.sin(rotRad) * distance,
                height,
                Math.cos(rotRad) * distance
            );
            modalCamera.lookAt(0, 0, 0);

            modalRenderer.render(modalScene, modalCamera);
        }

        function updateCameraLabels() {
            document.getElementById('height-val').textContent = document.getElementById('cam-height').value;
            document.getElementById('angle-val').textContent = document.getElementById('cam-angle').value;
            document.getElementById('rotation-val').textContent = document.getElementById('cam-rotation').value;
        }

        function setTopView() {
            document.getElementById('cam-height').value = 100;
            document.getElementById('cam-angle').value = 0;
            document.getElementById('cam-rotation').value = 0;
            updateCamera();
        }

        function setGameView() {
            document.getElementById('cam-height').value = 70;
            document.getElementById('cam-angle').value = 40;
            document.getElementById('cam-rotation').value = 0;
            updateCamera();
        }

        function setSeekerView() {
            document.getElementById('cam-height').value = 35;
            document.getElementById('cam-angle').value = 60;
            document.getElementById('cam-rotation').value = 45;
            updateCamera();
        }

        function prevBoard() {
            let newIndex = currentBoardIndex - 1;
            if (newIndex < 0) newIndex = BOARDS.length - 1;
            openModal(newIndex);
        }

        function nextBoard() {
            let newIndex = currentBoardIndex + 1;
            if (newIndex >= BOARDS.length) newIndex = 0;
            openModal(newIndex);
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (!document.getElementById('modal').classList.contains('active')) return;

            if (e.key === 'Escape') closeModal();
            if (e.key === 'ArrowLeft') prevBoard();
            if (e.key === 'ArrowRight') nextBoard();
        });

        // Close modal on overlay click
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') closeModal();
        });

        // Initialize
        window.onload = function() {
            BOARDS.forEach((board, index) => {
                createBoardPreview(board, index);
            });
        };
    </script>
</body>
</html>
